---
title: "Comparison of OHAS and NHTS Trip Costs"
author: "Huajie Yang"
date: "9/8/2015"
output: html_document
---
### Overview 
The results of OHAS, NHTS-Portland and NHTS-Tampa-Bay are similar. The results of NHTS-NHTS-Portland are not reasonable in some aspects, for example, travel time cost for HBW by low income group, which is probably caused by low sample size (2). The overall results of NHTS-Portland correspond with that of OHAS and NHTS-Tampa Bay.

```{r, echo=FALSE}
# Load required packages
require(dplyr)
require(ggplot2)
require(ggmap)
```


### OHAS
```{r, echo=FALSE}
setwd("~/tci")
load("output/OHAS/tcost.RData")

# make names for household income groups, trip purpose and calculation method
IcNames <- c("Low Income", "Mid Income", "High Income")
Ic <- c("lowInc", "midInc", "highInc")
names(IcNames) <- Ic

PrNames <- c("Work", "Shopping", "Recreation", "Other")
Pr <- c("hbw", "hbs", "hbr", "hbo")
names(PrNames) <- Pr

CmNames <- c("mintcost", "avgtcost", "maxtcost")
Cm <- c("min", "avg", "max")
names(CmNames) <- Cm  

```

**OHAS data description**
```{r}
# Number of household
nrow(tcost.hh)

# Number of household by household size
tcost.hh.hhsiz.freq <- tcost.hh %>%
                 group_by(HHSIZ) %>%
                 summarise(freq=n())
tcost.hh.hhsiz.freq

# Number of trips by income groups and and trip purposes 
tcost.hh.tpurp.inc.freq <- tcost.trip %>%
                           group_by(TripPurpose, inc.level) %>%
                           summarise(freq=n()) %>%
                           as.data.frame()
tcost.hh.tpurp.inc.freq
```


**OHAS: density_tcost.hh_by_inc.png**

```{r}
# Plot trip cost by income groups 
pden.inc <- ggplot(tcost.hh, aes(x = tcost, colour=inc.level, group=inc.level)) +
            geom_density(fill=NA, size=1) + labs(x="Travel Costs (minutes)") + xlim(0, 360) +
            scale_colour_discrete(name = 'Income Level')

pden.inc

```


**OHAS: density_tcost.hh_by_hhsiz.png**
```{r}
tcost.hh <- tcost.hh %>% 
  mutate(hhsiz.cat=cut(HHSIZ,
                       breaks=c(1, 2, 3, 4, 9),
                       labels=c("1", "2", "3", "4+"),   #allow alternative household grouping
                       include.lowest=T, right=F
  ))
pden.hhsiz <- ggplot(tcost.hh, aes(x = tcost, colour=hhsiz.cat, group=hhsiz.cat)) +
  geom_density(fill=NA, size=1) + labs(x="Travel Costs (minutes)") + xlim(0, 360) +
  scale_colour_discrete(name = 'Household Size')
pden.hhsiz
```

**OHAS: boxplot_tcost.hh_by_tpurp.inc.png**

```{r}
tcost.hh.tpurp <- tcost.hh.tpurp %>% 
  mutate(inc.level = factor(inc.level, levels=Ic, labels=c("Low Inc", "Mid Inc", "High Inc")),
         TripPurpose = factor(TripPurpose, levels=Pr, labels=c("HBW", "HB Shopping", "HB Recreation", "HB Other"))
  )

boxp.tpurp_inc <- ggplot(tcost.hh.tpurp, aes(x=TripPurpose, y=tcost, fill=inc.level)) +
  geom_boxplot() + labs(y="Generalized Travel Costs (minutes)") + xlab("Trip Purpose") + ylim(0, 250)  +
  scale_fill_discrete(name = 'Income Level')
boxp.tpurp_inc
```

**OHAS: lineplot_tcost.hh_by_tpurp.inc.png**
```{r}
t.dp <- ggplot(tcost.tpurp.inc, aes(x = inc.level, y = tcost.wtavg, colour=TripPurpose, group=TripPurpose))
t.dp + geom_line(fill=NA, size=1) + labs(x="Income Level") + labs(y="Travel Costs (minutes)") + ylim(0, 120)
```

### Portland
```{r, echo=FALSE}
setwd("~/tci")
load("output/NHTS09/Portland/tcost.RData")
```


**Portland data description**
```{r}
# Number of household
nrow(tcost.hh)

# Number of household by household size
tcost.hh.hhsiz.freq <- tcost.hh %>%
                 group_by(HHSIZ) %>%
                 summarise(freq=n())
tcost.hh.hhsiz.freq
# Number of trips by income groups and and trip purposes 
tcost.hh.tpurp.inc.freq <- tcost.trip %>%
                           group_by(TripPurpose, inc.level) %>%
                           summarise(freq=n())%>%
                           as.data.frame()
tcost.hh.tpurp.inc.freq
```



**Portland: density_tcost.hh_by_inc.png**

```{r}
# Plot trip cost by income groups 
pden.inc <- ggplot(tcost.hh, aes(x = tcost, colour=inc.level, group=inc.level)) +
            geom_density(fill=NA, size=1) + labs(x="Travel Costs (minutes)") + xlim(0, 360) +
            scale_colour_discrete(name = 'Income Level')

pden.inc

```


**Portland: density_tcost.hh_by_hhsiz.png**
```{r}
tcost.hh <- tcost.hh %>% 
  mutate(hhsiz.cat=cut(HHSIZ,
                       breaks=c(1, 2, 3, 4, 9),
                       labels=c("1", "2", "3", "4+"),   #allow alternative household grouping
                       include.lowest=T, right=F
  ))
pden.hhsiz <- ggplot(tcost.hh, aes(x = tcost, colour=hhsiz.cat, group=hhsiz.cat)) +
  geom_density(fill=NA, size=1) + labs(x="Travel Costs (minutes)") + xlim(0, 360) +
  scale_colour_discrete(name = 'Household Size')
pden.hhsiz
```

**Portland: boxplot_tcost.hh_by_tpurp.inc.png**

```{r}
tcost.hh.tpurp <- tcost.hh.tpurp %>% 
  mutate(inc.level = factor(inc.level, levels=Ic, labels=c("Low Inc", "Mid Inc", "High Inc")),
         TripPurpose = factor(TripPurpose, levels=Pr, labels=c("HBW", "HB Shopping", "HB Recreation", "HB Other"))
  )

boxp.tpurp_inc <- ggplot(tcost.hh.tpurp, aes(x=TripPurpose, y=tcost, fill=inc.level)) +
  geom_boxplot() + labs(y="Generalized Travel Costs (minutes)") + xlab("Trip Purpose") + ylim(0, 250)  +
  scale_fill_discrete(name = 'Income Level')
boxp.tpurp_inc
```

**Portland: lineplot_tcost.hh_by_tpurp.inc.png**
```{r}
t.dp <- ggplot(tcost.tpurp.inc, aes(x = inc.level, y = tcost.wtavg, colour=TripPurpose, group=TripPurpose))
t.dp + geom_line(fill=NA, size=1) + labs(x="Income Level") + labs(y="Travel Costs (minutes)") + ylim(0, 120)
```

### Tampa Bay
```{r, echo=FALSE}
setwd("~/tci")
load("output/NHTS09/TampaBay/tcost.RData")
```

**Tamba Baydata description**
```{r}
# Number of household
nrow(tcost.hh)

# Number of household by household size
tcost.hh.hhsiz.freq <- tcost.hh %>%
                 group_by(HHSIZ) %>%
                 summarise(freq=n())
tcost.hh.hhsiz.freq
# Number of trips by income groups and and trip purposes 
tcost.hh.tpurp.inc.freq <- tcost.trip %>%
                           group_by(TripPurpose, inc.level) %>%
                           summarise(freq=n()) %>%
                           as.data.frame()
tcost.hh.tpurp.inc.freq
```


**Tampa Bay: density_tcost.hh_by_inc.png**

```{r}
# Plot trip cost by income groups 
pden.inc <- ggplot(tcost.hh, aes(x = tcost, colour=inc.level, group=inc.level)) +
            geom_density(fill=NA, size=1) + labs(x="Travel Costs (minutes)") + xlim(0, 360) +
            scale_colour_discrete(name = 'Income Level')

pden.inc

```


**Tampa Bay: density_tcost.hh_by_hhsiz.png**
```{r}
tcost.hh <- tcost.hh %>% 
  mutate(hhsiz.cat=cut(HHSIZ,
                       breaks=c(1, 2, 3, 4, 9),
                       labels=c("1", "2", "3", "4+"),   #allow alternative household grouping
                       include.lowest=T, right=F
  ))
pden.hhsiz <- ggplot(tcost.hh, aes(x = tcost, colour=hhsiz.cat, group=hhsiz.cat)) +
  geom_density(fill=NA, size=1) + labs(x="Travel Costs (minutes)") + xlim(0, 360) +
  scale_colour_discrete(name = 'Household Size')
pden.hhsiz
```

**Tampa Bay: boxplot_tcost.hh_by_tpurp.inc.png**

```{r}
tcost.hh.tpurp <- tcost.hh.tpurp %>% 
  mutate(inc.level = factor(inc.level, levels=Ic, labels=c("Low Inc", "Mid Inc", "High Inc")),
         TripPurpose = factor(TripPurpose, levels=Pr, labels=c("HBW", "HB Shopping", "HB Recreation", "HB Other"))
  )

boxp.tpurp_inc <- ggplot(tcost.hh.tpurp, aes(x=TripPurpose, y=tcost, fill=inc.level)) +
  geom_boxplot() + labs(y="Generalized Travel Costs (minutes)") + xlab("Trip Purpose") + ylim(0, 250)  +
  scale_fill_discrete(name = 'Income Level')
boxp.tpurp_inc
```

**Tampa Bay: lineplot_tcost.hh_by_tpurp.inc.png**
```{r}
t.dp <- ggplot(tcost.tpurp.inc, aes(x = inc.level, y = tcost.wtavg, colour=TripPurpose, group=TripPurpose))
t.dp + geom_line(fill=NA, size=1) + labs(x="Income Level") + labs(y="Travel Costs (minutes)") + ylim(0, 120)
```


